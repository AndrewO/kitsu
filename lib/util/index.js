'use strict';var _regenerator=require('babel-runtime/regenerator'),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator'),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_typeof2=require('babel-runtime/helpers/typeof'),_typeof3=_interopRequireDefault(_typeof2);Object.defineProperty(exports,'__esModule',{value:!0}),exports.linkRelationships=exports.filterIncludes=exports.query=exports.errorHandler=void 0;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var errorHandler=exports.errorHandler=function(err){return{errors:[{title:err.statusMessage,detail:err.statusMessage,code:err.statusCode,status:err.statusCode}]}},query=exports.query=function(opts){var query='',_loop=function(param){'object'===(0,_typeof3.default)(opts[param])?Object.keys(opts[param]).forEach(function(value){query+='&'+param+'['+value+']='+opts[param][value]}):'string'==typeof opts[param]&&(query+='&'+param+'='+opts[param])};for(var param in opts)_loop(param);return opts?'?'+query.slice(1):''},filterIncludes=exports.filterIncludes=function(){var _ref=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function _callee2(included,_ref2){var id=_ref2.id,type=_ref2.type;return _regenerator2.default.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt('return',included.filter(function(){var _ref3=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function _callee(obj){return _regenerator2.default.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,linkRelationships([obj],included);case 2:return _context.abrupt('return',obj.id===id&&obj.type===type);case 3:case'end':return _context.stop();}},_callee,void 0)}));return function(){return _ref3.apply(this,arguments)}}()));case 1:case'end':return _context2.stop();}},_callee2,void 0)}));return function(){return _ref.apply(this,arguments)}}(),linkRelationships=exports.linkRelationships=function(){var _ref4=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function _callee3(data,included){var attributes,relationships,key,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,_ref5,id,type,_relationships$key$da,_id,_type;return _regenerator2.default.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:_context3.prev=0,attributes=data.attributes,relationships=data.relationships,_context3.t0=_regenerator2.default.keys(relationships);case 3:if((_context3.t1=_context3.t0()).done){_context3.next=48;break}if(key=_context3.t1.value,!(relationships[key].data&&relationships[key].data.constructor===Array)){_context3.next=39;break}_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0,_context3.prev=9,_iterator=relationships[key].data[Symbol.iterator]();case 11:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){_context3.next=23;break}return _ref5=_step.value,id=_ref5.id,type=_ref5.type,attributes[type]||(attributes[type]=[]),_context3.t2=attributes[type],_context3.next=18,filterIncludes(included,{id:id,type:type});case 18:_context3.t3=_context3.sent[0],_context3.t2.push.call(_context3.t2,_context3.t3);case 20:_iteratorNormalCompletion=!0,_context3.next=11;break;case 23:_context3.next=29;break;case 25:_context3.prev=25,_context3.t4=_context3['catch'](9),_didIteratorError=!0,_iteratorError=_context3.t4;case 29:_context3.prev=29,_context3.prev=30,!_iteratorNormalCompletion&&_iterator.return&&_iterator.return();case 32:if(_context3.prev=32,!_didIteratorError){_context3.next=35;break}throw _iteratorError;case 35:return _context3.finish(32);case 36:return _context3.finish(29);case 37:_context3.next=46;break;case 39:if(!relationships[key].data){_context3.next=46;break}if(_relationships$key$da=relationships[key].data,_id=_relationships$key$da.id,_type=_relationships$key$da.type,attributes[_type]){_context3.next=45;break}return _context3.next=44,filterIncludes(included,{id:_id,type:_type});case 44:attributes[_type]=_context3.sent[0];case 45:delete attributes[_type].relationships;case 46:_context3.next=3;break;case 48:delete data.relationships,_context3.next=54;break;case 51:_context3.prev=51,_context3.t5=_context3['catch'](0),console.log(_context3.t5);case 54:case'end':return _context3.stop();}},_callee3,void 0,[[0,51],[9,25,29,37],[30,,32,36]])}));return function(){return _ref4.apply(this,arguments)}}();